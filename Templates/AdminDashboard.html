<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GenZ IT - Admin Dashboard</title>
    <link rel="stylesheet" href="/Design/page.css">
    <style>
        body {
            font-family: sans-serif;
            background-color: #f4f4f9;
            padding: 20px;
        }

        .dashboard-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #eee;
            padding-bottom: 20px;
            margin-bottom: 20px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab-btn {
            padding: 10px 20px;
            background: #ddd;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            font-weight: bold;
        }

        .tab-btn.active {
            background: #007bff;
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        th,
        td {
            padding: 12px;
            border: 1px solid #ddd;
            text-align: left;
        }

        th {
            background-color: #f8f9fa;
        }

        .btn-danger {
            background-color: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 3px;
        }

        .btn-primary {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 10px 15px;
            cursor: pointer;
            border-radius: 5px;
            margin-bottom: 10px;
        }

        form {
            display: grid;
            gap: 10px;
            max-width: 500px;
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #eee;
            border-radius: 5px;
        }

        input,
        select,
        textarea {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
    </style>
</head>

<body>

    <div class="dashboard-container">
        <div class="header">
            <h1>Admin Dashboard</h1>
            <a href="/logout" style="color: red; text-decoration: none; font-weight: bold;">Logout</a>
        </div>

        <div class="tabs">
            <button class="tab-btn active" onclick="showTab('overview')">Overview</button>
            <button class="tab-btn" onclick="showTab('courses')">Manage Courses</button>
            <button class="tab-btn" onclick="showTab('students')">Manage Students</button>
        </div>

        <!-- OVERVIEW TAB -->
        <div id="overview" class="tab-content active">
            <div style="display: flex; gap: 20px; margin-bottom: 30px;">
                <div style="background: #007bff; color: white; padding: 20px; border-radius: 8px; flex: 1;">
                    <h3>Total Students</h3>
                    <p id="total-students" style="font-size: 2rem; font-weight: bold;">0</p>
                </div>
                <div style="background: #28a745; color: white; padding: 20px; border-radius: 8px; flex: 1;">
                    <h3>Total Earnings</h3>
                    <p id="total-earnings" style="font-size: 2rem; font-weight: bold;">0 BDT</p>
                </div>
            </div>

            <h3>Course Performance (Best Performing First)</h3>
            <table>
                <thead>
                    <tr>
                        <th>Course Name</th>
                        <th>Students Enrolled</th>
                        <th>Revenue (BDT)</th>
                    </tr>
                </thead>
                <tbody id="stats-list">
                    <!-- Stats loaded via JS -->
                </tbody>
            </table>
        </div>

        <!-- COURSES TAB -->
        <div id="courses" class="tab-content">
            <h2>Courses</h2>
            <button class="btn-primary" onclick="toggleForm('course-form')">+ Add New Course</button>

            <form id="course-form" style="display: none;" onsubmit="addCourse(event)">
                <input type="text" id="c_name" placeholder="Course Name" required>
                <input type="number" id="c_fee" placeholder="Fee (BDT)" required>
                <input type="text" id="c_duration" placeholder="Duration (e.g. 3 Months)">
                <textarea id="c_desc" placeholder="Description"></textarea>
                <button type="submit" class="btn-primary">Save Course</button>
            </form>

            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Fee</th>
                        <th>Duration</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="course-list">
                    <!-- Loaded via JS -->
                </tbody>
            </table>
        </div>

        <!-- STUDENTS TAB -->
        <div id="students" class="tab-content">
            <h2>Registered Students</h2>
            <!-- <button class="btn-primary" onclick="toggleForm('student-form')">+ Add Student (Manual)</button> -->

            <form id="student-form" style="display: none;" onsubmit="addStudent(event)">
                <input type="text" id="s_name" placeholder="Full Name" required>
                <input type="email" id="s_email" placeholder="Email" required>
                <input type="password" id="s_pass" placeholder="Password" required>
                <button type="submit" class="btn-primary">Register Student</button>
            </form>

            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Course</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="student-list">
                    <!-- Loaded via JS -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Tab Logic
        function showTab(id) {
            document.querySelectorAll('.tab-content').forEach(d => d.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            event.target.classList.add('active');
            if (id === 'courses') loadCourses();
            if (id === 'students') loadStudents();
            if (id === 'overview') loadStats();
        }

        function toggleForm(id) {
            const form = document.getElementById(id);
            form.style.display = form.style.display === 'none' ? 'grid' : 'none';
        }

        // API Calls
        async function loadStats() {
            const res = await fetch('/admin/stats');
            const data = await res.json();

            document.getElementById('total-students').innerText = data.totalStudents;
            document.getElementById('total-earnings').innerText = data.totalEarnings.toLocaleString() + ' BDT';

            const tbody = document.getElementById('stats-list');
            tbody.innerHTML = data.courseStats.map(s => `
                <tr>
                    <td>${s.name}</td>
                    <td>${s.count}</td>
                    <td>${s.earnings.toLocaleString()}</td>
                </tr>
            `).join('');
        }

        async function loadCourses() {
            const res = await fetch('/admin/courses');
            const data = await res.json();
            const tbody = document.getElementById('course-list');
            tbody.innerHTML = data.map(c => `
                <tr>
                    <td>${c.courseName}</td>
                    <td>${c.courseFee}</td>
                    <td>${c.courseDuration}</td>
                    <td><button class="btn-danger" onclick="deleteCourse('${c._id}')">Delete</button></td>
                </tr>
            `).join('');
        }

        async function loadStudents() {
            const res = await fetch('/admin/students');
            const data = await res.json();
            const tbody = document.getElementById('student-list');
            tbody.innerHTML = data.map(s => `
                <tr>
                    <td>${s.fullName}</td>
                    <td>${s.email}</td>
                    <td>${s.course}</td>
                    <td><button class="btn-danger" onclick="deleteStudent('${s._id}')">Delete/Block</button></td>
                </tr>
            `).join('');
        }

        async function addCourse(e) {
            e.preventDefault();
            const body = {
                courseName: document.getElementById('c_name').value,
                courseFee: document.getElementById('c_fee').value,
                courseDuration: document.getElementById('c_duration').value,
                description: document.getElementById('c_desc').value,
                id: Date.now() // Simple ID generation
            };

            await fetch('/admin/course', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(body)
            });
            alert('Course Added!');
            loadCourses();
            e.target.reset();
        }

        async function deleteCourse(id) {
            if (!confirm('Delete this course?')) return;
            await fetch(`/admin/course/${id}`, { method: 'DELETE' });
            loadCourses();
        }

        async function deleteStudent(id) {
            if (!confirm('Are you sure you want to remove this student?')) return;
            await fetch(`/admin/student/${id}`, { method: 'DELETE' });
            loadStudents();
        }

        // Init
        loadStats();
    </script>
</body>

</html>